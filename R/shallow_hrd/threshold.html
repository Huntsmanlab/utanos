<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<style>body{background-color:white;}</style>
<script src="lib/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="lib/jquery-1.11.1/jquery.min.js"></script>
<script src="lib/highlight-8.9.1/highlight.min.js"></script>
<script src="lib/difflib-1/difflib.js"></script>
<link href="lib/codediff-1/codediff.css" rel="stylesheet" />
<link href="lib/codediff-1/googlecode.css" rel="stylesheet" />
<script src="lib/codediff-1/codediff.js"></script>
<script src="lib/diffr-binding-0.1/diffr.js"></script>

</head>
<body>
<div id="htmlwidget_container">
  <div class="diffr html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-08907ffae2e7b86e3c2e" style="width:960px;height:500px;"></div>
</div>
<script type="application/json" data-for="htmlwidget-08907ffae2e7b86e3c2e">{"x":{"message":["function (..., domain = NULL, appendLF = TRUE) ","{","    cond <- if (...length() == 1L && inherits(..1, \"condition\")) {","        if (nargs() > 1L) ","            warning(\"additional arguments ignored in message()\")","        ..1","    }","    else {","        msg <- .makeMessage(..., domain = domain, appendLF = appendLF)","        call <- sys.call()","        simpleMessage(msg, call)","    }","    defaultHandler <- function(c) {","        cat(conditionMessage(c), file = stderr(), sep = \"\")","    }","    withRestarts({","        signalCondition(cond)","        defaultHandler(cond)","    }, muffleMessage = function() NULL)","    invisible()","}"],"contextSize":3,"minJumpSize":10,"wordWrap":true,"file1":"v1.R","file2":"v2.R","f1":"##### Find Threshold 1 #####\n\ncat(\"Find Threshold 1... \\n\")\n\nX = read.table(paste0(outputPath,\"/\",NAMEEE,\"_ratio_median_gathered.txt\"), sep = \"\\t\", header = TRUE)\n\nX = X[which(X$chr != 23),]\n\n\n# true value\n\nB <- data.frame(ratio_file_tsv)\nB=B[,-1]\ncolnames(B) <- c(\"chr\", \"start\", \"end\", \"ratio\", \"ratio_median\")\n\n\nGRanges_object_ratio_file = makeGRangesFromDataFrame(B,keep.extra.columns = TRUE, ignore.strand = TRUE, seqinfo = NULL,\n                                                     seqnames.field = \"chr\",\n                                                     start.field = \"start\", end.field = \"end\")\ni=1\nL=dim(X)[1]\n\nwhile (i < L){\n  gr=GRanges(seqnames=c(X[i,1]),\n             ranges=IRanges(start=c(X[i,3]),end=c(X[i,4])),\n             strand=c(\"*\")) # to overlap\n  subsetGRobject = subsetByOverlaps(GRanges_object_ratio_file, gr)\n  X[i,5] = median(subsetGRobject$ratio)\n  i=i+1\n}\n\n\nX = X[which(X[,6] > 2999999),]\n\nL=dim(X)[1]\nX=data.matrix(X)\n\ntest=c()\ni=1\nfor (i in 1:L){\n  v=i+1\n  for (y in v:L-1){\n    test = c(test, abs(X[i,5] - X[y,5]))}\n}  \n\n\nlist_THR = c()\nc = 0\n\nnb_simulations = 100000\n\n\nwhile (c < nb_simulations){\n  n = length(test)\n  n\n  \n  rand_n = sample(2:n,1)\n  rand_n\n  \n  sampled_test = sample(test,rand_n)\n  \n  ## First maxima\n  \n  maxx = localMaxima(density(sampled_test)$y)[1]\n  First_local_maxima = density(sampled_test)$x[maxx]\n  \n  \n  ## First minima \n  \n  minx = localMinima(density(sampled_test)$y)\n  First_local_minima = density(sampled_test)$x[minx][which(density(sampled_test)$x[minx] > First_local_maxima)][1]\n  \n  \n  ## Second maxima\n  \n  maxx = localMaxima(density(sampled_test)$y)[2]\n  Second_local_maxima = density(sampled_test)$x[maxx]\n  \n  if (is.na(Second_local_maxima) == FALSE){\n    if (abs((First_local_minima-First_local_maxima)-(Second_local_maxima-First_local_minima)) < 0.10){\n      list_THR = c(list_THR,First_local_minima)\n      test_optimized = sampled_test\n    }\n  }\n  c = c + 1\n}\n\n\n\nif (is.null(list_THR) == TRUE){\n  \n  ## First maxima\n  \n  maxx = localMaxima(density(test)$y)[1]\n  First_maxima = density(test)$x[maxx]\n  \n  ## First minima\n  \n  minx = localMinima(density(test)$y)\n  First_local_minima = density(test)$x[minx][which(density(test)$x[minx] > First_maxima)][1]\n  \n  h <- hns(test, deriv.order = 2)\n  den <- kdde(test, h=h, deriv.order = 2)\n  \n  flections<-c()\n  for(i in 2:length(den$estimate)){\n    if(sign(den$estimate[i])!=sign(den$estimate[i-1])){\n      flections<-c(flections,i)\n    }\n  }\n  \n  All_inflexion_point = den$x[flections][which(den$x[flections] > First_maxima)]\n  Threshold_change_sign_second_derivative_2nd_value = sort(All_inflexion_point)[1]\n  \n  Threshold = min(Threshold_change_sign_second_derivative_2nd_value, First_local_minima)\n  \n}\n\n\nif (is.na(mean(list_THR)) == FALSE){\n  number_positive = length(list_THR)\n  \n  Threshold = mean(list_THR)\n  \n  Threshold_first_round_simulation = Threshold\n}","f2":"##### NEW Find Threshold 2 #####\n\ncat(\"Find new Threshold 2... \\n\")\n\n\ngraphe_V_tab = data.frame(graphe_V_tab)\n\ngraphe_V_tab$size = graphe_V_tab$end - graphe_V_tab$start + 1\n\ncopy_graphe_V_tab = graphe_V_tab\ncopy_graphe_V_tab = copy_graphe_V_tab[,-8]\ncopy_graphe_V_tab = copy_graphe_V_tab[,-7]\ncopy_graphe_V_tab = copy_graphe_V_tab[,-1]\n\ncopy_graphe_V_tab$size <- copy_graphe_V_tab$end - copy_graphe_V_tab$start + 1\n\nX = copy_graphe_V_tab\n\nY = X\n\nY = Y[which(Y$chr != 23),]\n\n\nL=dim(Y)[1]\nX=data.matrix(Y)\n\ntest=c()\ni=1\nfor (i in 1:L){\n  v=i+1\n  for (y in v:L-1){\n    test = c(test, abs(Y[i,5] - Y[y,5]))}\n}  \n\n\n\n### multiple test THR\n\nlist_THR = c()\nlist_max2 = c()\nc = 0\n\n\nwhile (c < nb_simulations){\n  n = length(test)\n  n\n  \n  rand_n = sample(2:n,1)\n  rand_n\n  \n  sampled_test = sample(test,rand_n)\n  \n  ## First maxima\n  \n  maxx = localMaxima(density(sampled_test)$y)[1]\n  First_local_maxima = density(sampled_test)$x[maxx]\n  \n  \n  ## First minima \n  \n  minx = localMinima(density(sampled_test)$y)\n  First_local_minima = density(sampled_test)$x[minx][which(density(sampled_test)$x[minx] > First_local_maxima)][1]\n  \n  \n  ## Second maxima\n  \n  maxx = localMaxima(density(sampled_test)$y)[2]\n  Second_local_maxima = density(sampled_test)$x[maxx]\n  \n  if (is.na(Second_local_maxima) == FALSE){\n    if (abs((First_local_minima-First_local_maxima)-(Second_local_maxima-First_local_minima)) < 0.05){\n      list_THR = c(list_THR,First_local_minima)\n      list_max2 = c(list_max2, Second_local_maxima)\n      test_optimized = sampled_test\n    }\n  }\n  c = c + 1\n}\n\n\n### Faire second inflexion point if no THR found\n\n\nif (is.null(list_THR) == TRUE){\n  \n  ## First maxima\n  \n  maxx = localMaxima(density(test)$y)[1]\n  First_maxima = density(test)$x[maxx]\n  \n  \n  cat(\"First_minima... \\n\")\n  \n  ## First minima\n  \n  minx = localMinima(density(test)$y)\n  First_local_minima = density(test)$x[minx][which(density(test)$x[minx] > First_maxima)][1]\n  \n  h <- hns(test, deriv.order = 2)\n  den <- kdde(test, h=h, deriv.order = 2)\n  \n  flections<-c()\n  for(i in 2:length(den$estimate)){\n    if(sign(den$estimate[i])!=sign(den$estimate[i-1])){\n      flections<-c(flections,i)\n    }\n  }\n  \n  All_inflexion_point = den$x[flections][which(den$x[flections] > First_maxima)]\n  Threshold_change_sign_second_derivative_2nd_value = sort(All_inflexion_point)[1]\n  \n  Threshold = min(Threshold_change_sign_second_derivative_2nd_value, First_local_minima)\n  \n}\n\n\nif (is.na(mean(list_THR)) == FALSE){\n  number_positive = length(list_THR)\n  \n  Threshold = mean(list_THR)\n  \n  Threshold_second_round_simulation = Threshold\n  \n  MAX2 = mean(list_max2)\n}\n\n\n\n###  Classical THR + graphe\n\nX = copy_graphe_V_tab\n# size > 3Mb\nX = X[which(X[,6] > 2999999),]\n\n# Segments are defined as ‘large’ if size > (Q3-Q1)/2\nX = X[which(X[,6] > ((quantile(X[,6])[[4]] - quantile(X[,6])[[2]])/2)),]  \n\n\nX = X[which(X$chr != 23),]\n\nL=dim(X)[1]\nX=data.matrix(X)\n\ntest=c()\ni=1\nfor (i in 1:L){\n  v=i+1\n  for (y in v:L-1){\n    test = c(test, abs(X[i,5] - X[y,5]))}\n}  \n\n## First maxima\n\nmaxx = localMaxima(density(test)$y)[1]\nFirst_local_maxima = density(test)$x[maxx]\n\n\n## First minima \n\nminx = localMinima(density(test)$y)\nFirst_local_minima = density(test)$x[minx][which(density(test)$x[minx] > First_local_maxima)][1]\n\n\n## Second maxima\n\nmaxx = localMaxima(density(test)$y)[2]\nSecond_local_maxima = density(test)$x[maxx]\n\n\nif (is.na(Second_local_maxima) == FALSE){\n  if (abs((First_local_minima-First_local_maxima)-(Second_local_maxima-First_local_minima)) < 0.10){\n    if (First_local_minima < Threshold){\n      Threshold = First_local_minima\n      Threshold_global_view = First_local_minima\n      MAX2 = Second_local_maxima\n    }\n  }\n}"},"evals":[],"jsHooks":[]}</script>
<script type="application/htmlwidget-sizing" data-for="htmlwidget-08907ffae2e7b86e3c2e">{"viewer":{"width":450,"height":350,"padding":15,"fill":true},"browser":{"width":960,"height":500,"padding":40,"fill":false}}</script>
</body>
</html>
